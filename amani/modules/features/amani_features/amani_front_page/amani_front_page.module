<?php
/**
 * @file
 * Code for the Amani: Front page feature.
 */

include_once 'amani_front_page.features.inc';

/**
 * Page preprocessor.
 */
function amani_front_page_preprocess_page(&$vars) {

  // Do not display title on homepage.
  if ($vars['is_front']) {
    drupal_set_title('');
  }
}

/**
* Implements hook_block_info().
*/
function amani_front_page_block_info() {
  $blocks = array();
  $blocks['special_event'] = array(
    'info' => t('Special Event / Feature Callout'),
  );
  $blocks['twitter_feed'] = array(
    'info' => t('Twitter Feed'),
    'status' => TRUE
  );
  return $blocks;
}

/**
 * Implements hook_block_view().
 */
function amani_front_page_block_view($delta='') {
  $block = array();

  switch($delta) {
    case 'special_event' :
      $block['content'] = special_event_view();
      break;
    case 'twitter_feed' :
      $block['content'] = twitter_feed_view();
      break;
  }
  return $block;
}

/**
 * Custom function to assemble renderable array for block content.
 * Returns a renderable array with the block content.
 * @return
 *   returns a renderable array of block content.
 */
function special_event_view() {
  $block = array();

  // Capture WYSIWYG text from the variable
  $text = variable_get('text_body', '');

  // Block output in HTML with div wrapper
  $block = array(
    'message' => array(
      '#type' => 'markup',
      '#markup' => $text,
      '#suffix' => '',
    ),
  );
  return $block;
}

/**
 * Implements hook_block_configure().
 */
function amani_front_page_block_configure($delta='') {
  $form = array();
  switch($delta) {
    case 'special_event' :
      // Text field form element
      $form['text_body'] = array(
        '#type' => 'text_format',
        '#title' => t('Enter your text here in WYSIWYG format'),
        '#default_value' => variable_get('text_body', ''),
      );
      break;
    case 'twitter_feed' :
      // Text field form element
      $form['text_twitter_body'] = array(
        '#type' => 'text_format',
        '#title' => t('Enter your text here in WYSIWYG format'),
        '#default_value' => variable_get('text_twitter_body', ''),
      );
      break;
  }
  return $form;
}

/**
 * Implements hook_block_save().
 */
function amani_front_page_block_save($delta = '', $edit = array()) {
  switch($delta) {
    case 'special_event' :
      // Saving the WYSIWYG text
      variable_set('text_body', $edit['text_body']['value']);

    case 'twitter_feed' :
      // Saving the WYSIWYG text
      variable_set('text_twitter_body', $edit['text_twitter_body']['value']);

  }
}

function twitter_feed_view() {
  $block = array();

  // Capture WYSIWYG text from the variable
  $texte = variable_get('text_twitter_body', '');

  // Block output in HTML with div wrapper
  $block = array(
    'message' => array(
      '#type' => 'markup',
      '#markup' => $texte,
      '#suffix' => '',
    ),
  );
  return $block;
}


  // case 'example_configurable_text':
  //     // The subject is displayed at the top of the block. Note that it
  //     // should be passed through t() for translation. The title configured
  //     // for the block using Drupal UI supercedes this one.
  //     $block['subject'] = t('Title of first block (example_configurable_text)');
  //     // The content of the block is typically generated by calling a custom
  //     // function.
  //     $block['content'] = block_example_contents($delta);
  //     break;

  //   case 'example_empty':
  //     $block['subject'] = t('Title of second block (example_empty)');
  //     $block['content'] = block_example_contents($delta);
  //     break;

  //   case 'example_uppercase':
  //     $block['subject'] = t("uppercase this please");
  //     $block['content'] = t("This block's title will be changed to uppercase. Any other block with 'uppercase' in the subject or title will also be altered. If you change this block's title through the UI to omit the word 'uppercase', it will still be altered to uppercase as the subject key has not been changed.");
  //     break;
